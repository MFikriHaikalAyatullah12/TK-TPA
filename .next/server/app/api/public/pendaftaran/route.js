"use strict";(()=>{var a={};a.id=9479,a.ids=[9479],a.modules={517:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:a=>{a.exports=require("fs")},1017:a=>{a.exports=require("path")},965:(a,e,n)=>{n.r(e),n.d(e,{headerHooks:()=>h,originalPathname:()=>k,patchFetch:()=>b,requestAsyncStorage:()=>d,routeModule:()=>m,serverHooks:()=>c,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>f});var t={};n.r(t),n.d(t,{GET:()=>u,POST:()=>l});var r=n(5419),i=n(9108),s=n(9678),p=n(8070),o=n(9631);async function l(a){try{let e=await a.formData(),t={nama:e.get("nama"),tanggalLahir:e.get("tanggalLahir"),tempatLahir:e.get("tempatLahir"),jenisKelamin:e.get("jenisKelamin"),alamat:e.get("alamat"),namaAyah:e.get("namaAyah"),namaIbu:e.get("namaIbu"),pekerjaanAyah:e.get("pekerjaanAyah"),pekerjaanIbu:e.get("pekerjaanIbu"),nomorTelepon:e.get("nomorTelepon"),pendidikanTerakhir:e.get("pendidikanTerakhir"),alamatEmail:e.get("alamatEmail")||null,tanggalDaftar:new Date,statusPendaftaran:"PENDING",keterangan:e.get("keterangan")||null},r=e.get("foto");if(r&&r.size>0){let a=n(7147),e=n(1017),t=e.join(process.cwd(),"public","uploads","santri");a.existsSync(t)||a.mkdirSync(t,{recursive:!0});let i=Date.now(),s=r.name.split(".").pop(),p=`santri_${i}.${s}`,o=e.join(t,p),l=await r.arrayBuffer(),u=Buffer.from(l);a.writeFileSync(o,u)}let i=await o._.user.findFirst({where:{role:"ADMIN"},include:{tpaInfo:!0}});if(!i||!i.tpaInfo)return p.Z.json({error:"Tidak ada admin TPA yang tersedia"},{status:400});let s=await o._.santri.create({data:{namaLengkap:t.nama,tempatLahir:t.tempatLahir,tanggalLahir:new Date(t.tanggalLahir),jenisKelamin:t.jenisKelamin,alamat:t.alamat,namaAyah:t.namaAyah||"",namaIbu:t.namaIbu||"",pekerjaanAyah:t.pekerjaanAyah||"",pekerjaanIbu:t.pekerjaanIbu||"",noTelepon:t.nomorTelepon,kelasSebelumnya:t.pendidikanTerakhir||"",targetHafalan:t.alamatEmail||"",tpaInfoId:i.tpaInfo.id}});return p.Z.json({success:!0,message:"Pendaftaran berhasil! Data Anda telah tersimpan dan akan segera diproses.",data:{id:s.id,namaLengkap:s.namaLengkap,status:s.status}})}catch(a){return console.error("Error creating santri:",a),p.Z.json({error:"Gagal menyimpan data pendaftaran. Silakan coba lagi."},{status:500})}}async function u(){return p.Z.json({message:"Endpoint untuk pendaftaran santri"})}let m=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/public/pendaftaran/route",pathname:"/api/public/pendaftaran",filename:"route",bundlePath:"app/api/public/pendaftaran/route"},resolvedPagePath:"D:\\FILE FIKRI\\PROGRAM CODINGAN\\TK TPA\\src\\app\\api\\public\\pendaftaran\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:c,headerHooks:h,staticGenerationBailout:f}=m,k="/api/public/pendaftaran/route";function b(){return(0,s.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:g})}},9631:(a,e,n)=>{n.d(e,{_:()=>r});let t=require("@prisma/client"),r=globalThis.prisma||new t.PrismaClient}};var e=require("../../../../webpack-runtime.js");e.C(a);var n=a=>e(e.s=a),t=e.X(0,[1638,6206],()=>n(965));module.exports=t})();