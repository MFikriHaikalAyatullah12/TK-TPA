"use strict";(()=>{var a={};a.id=9479,a.ids=[9479],a.modules={517:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:a=>{a.exports=require("fs")},1017:a=>{a.exports=require("path")},1821:(a,e,n)=>{n.r(e),n.d(e,{headerHooks:()=>f,originalPathname:()=>y,patchFetch:()=>b,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>k});var t={};n.r(t),n.d(t,{GET:()=>m,POST:()=>u,dynamic:()=>l});var r=n(5419),i=n(9108),s=n(9678),o=n(8070),p=n(9631);let l="force-dynamic";async function u(a){try{let e=await a.formData(),t={nama:e.get("nama"),tanggalLahir:e.get("tanggalLahir"),tempatLahir:e.get("tempatLahir"),jenisKelamin:e.get("jenisKelamin"),alamat:e.get("alamat"),namaAyah:e.get("namaAyah"),namaIbu:e.get("namaIbu"),pekerjaanAyah:e.get("pekerjaanAyah"),pekerjaanIbu:e.get("pekerjaanIbu"),nomorTelepon:e.get("nomorTelepon"),pendidikanTerakhir:e.get("pendidikanTerakhir"),alamatEmail:e.get("alamatEmail")||null,tanggalDaftar:new Date,statusPendaftaran:"PENDING",keterangan:e.get("keterangan")||null},r=e.get("foto");if(r&&r.size>0){let a=n(7147),e=n(1017),t=e.join(process.cwd(),"public","uploads","santri");a.existsSync(t)||a.mkdirSync(t,{recursive:!0});let i=Date.now(),s=r.name.split(".").pop(),o=`santri_${i}.${s}`,p=e.join(t,o),l=await r.arrayBuffer(),u=Buffer.from(l);a.writeFileSync(p,u)}let i=await p._.user.findFirst({where:{role:"ADMIN"},include:{tpaInfo:!0}});if(!i||!i.tpaInfo)return o.Z.json({error:"Tidak ada admin TPA yang tersedia"},{status:400});let s=await p._.santri.create({data:{namaLengkap:t.nama,tempatLahir:t.tempatLahir,tanggalLahir:new Date(t.tanggalLahir),jenisKelamin:t.jenisKelamin,alamat:t.alamat,namaAyah:t.namaAyah||"",namaIbu:t.namaIbu||"",pekerjaanAyah:t.pekerjaanAyah||"",pekerjaanIbu:t.pekerjaanIbu||"",noTelepon:t.nomorTelepon,kelasSebelumnya:t.pendidikanTerakhir||"",targetHafalan:t.alamatEmail||"",tpaInfoId:i.tpaInfo.id}});return o.Z.json({success:!0,message:"Pendaftaran berhasil! Data Anda telah tersimpan dan akan segera diproses.",data:{id:s.id,namaLengkap:s.namaLengkap,status:s.status}})}catch(a){return console.error("Error creating santri:",a),o.Z.json({error:"Gagal menyimpan data pendaftaran. Silakan coba lagi."},{status:500})}}async function m(){return o.Z.json({message:"Endpoint untuk pendaftaran santri"})}let d=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/public/pendaftaran/route",pathname:"/api/public/pendaftaran",filename:"route",bundlePath:"app/api/public/pendaftaran/route"},resolvedPagePath:"/workspaces/TK-TPA/src/app/api/public/pendaftaran/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:g,staticGenerationAsyncStorage:c,serverHooks:h,headerHooks:f,staticGenerationBailout:k}=d,y="/api/public/pendaftaran/route";function b(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:c})}},9631:(a,e,n)=>{n.d(e,{_:()=>r});let t=require("@prisma/client"),r=globalThis.prisma??new t.PrismaClient({log:["error"]})}};var e=require("../../../../webpack-runtime.js");e.C(a);var n=a=>e(e.s=a),t=e.X(0,[1638,6206],()=>n(1821));module.exports=t})();